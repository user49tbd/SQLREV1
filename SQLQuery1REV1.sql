--EX.01
CREATE DATABASE ALUNO_CURSO_DICIPLINA
USE ALUNO_CURSO_DICIPLINA
CREATE TABLE ALUNO(
RA			INT				NOT NULL,
NOME		VARCHAR(40)		NOT NULL,
SOBRENOME	VARCHAR(40)		NOT NULL,
RUA			VARCHAR(40)		NOT NULL,
NUM			INT				NOT NULL,
BAIRRO		VARCHAR(40)		NOT NULL,
CEP			CHAR(07)		NOT NULL,
TELEFONE	CHAR(08)		NULL
PRIMARY KEY (RA)
)
INSERT INTO ALUNO
VALUES
(12345,'José','Silva','Almirante Noronha',236,'Jardim São Paulo','1589000','69875287'),
(12346,'Ana','Maria Bastos','Anhaia',1568,'Barra Funda','3569000','25698526'),
(12347,'Mario','Santos','XV de Novembro',1841,'Centro','1020030',NULL),
(12348,'Marcia','Neves','Voluntários da Patria',225,'Santana','2785090','78964152')

CREATE TABLE CURSOS(
CODIGO			INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
CARGA_HORARIA	INT				NOT NULL,
TURNO			VARCHAR(07)		NOT NULL
PRIMARY KEY (CODIGO)
)

INSERT INTO CURSOS
VALUES
(1,'Informática',2800,'Tarde'),
(2,'Informática',2800,'Noite'),
(3,'Logística',2650,'Tarde'),
(4,'Logística',2650,'Noite'),
(5,'Plásticos',2500,'Tarde'),
(6,'Plásticos',2500,'Noite')

CREATE TABLE DISCIPLINAS(
CODIGO			INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
CARGA_HORARIA	INT				NOT NULL,
TURNO			VARCHAR(07)		NOT NULL,
SEMESTRE		INT				NOT NULL
PRIMARY KEY (CODIGO)
)

INSERT INTO DISCIPLINAS
VALUES
(1,'Informática',4,'Tarde',1),
(2,'Informática',4,'Noite',1),
(3,'Quimica',4,'Tarde',1),
(4,'Quimica',4,'Noite',1),
(5,'Banco de Dados I',2,'Tarde',3),
(6,'Banco de Dados I',2,'Noite',3),
(7,'Estrutura de Dados',4,'Tarde',4),
(8,'Estrutura de Dados',4,'Noite',4)
--OP1
SELECT AL.NOME+AL.SOBRENOME AS NOME_COMPLETO FROM  ALUNO AL
--OP2
SELECT AL.RUA,AL.NUM,AL.BAIRRO,AL.CEP FROM ALUNO AL
WHERE AL.TELEFONE IS NULL
--OP3
SELECT AL.TELEFONE FROM ALUNO AL
WHERE AL.RA = 12348
--OP4
SELECT C.NOME,C.TURNO FROM CURSOS C
WHERE C.CARGA_HORARIA = 2800
--OP5
SELECT D.SEMESTRE FROM DISCIPLINAS D
WHERE D.NOME = 'Banco de Dados I' AND D.TURNO = 'noite'
--------------------------------------------------------------------------------------------------------------
--EX.02
CREATE DATABASE CARRO_PECAS
USE CARRO_PECAS
CREATE TABLE CARRO(
PLACA		CHAR(07)		NOT NULL,
MARCA		VARCHAR(40)		NOT NULL,
MODELO		VARCHAR(40)		NOT NULL,
COR			VARCHAR(40)		NOT NULL,
ANO			INT				NOT NULL,
PRIMARY KEY (PLACA)
)
INSERT INTO CARRO
VALUES
('AFT9087','VW','Gol','Preto',2007),
('DXO9876','Ford','Ka','Azul',2000),
('EGT4631','Renault','Clio','Verde',2004),
('LKM7380','Fiat','Palio','Prata',1997),
('BCD7521','Ford','Fiesta','Preto',1999)

CREATE TABLE CLIENTE(
NOME			VARCHAR(40)		NOT NULL,
LOGRADOURO		VARCHAR(40)		NOT NULL,
NUM				INT				NOT NULL,
BAIRRO			VARCHAR(40)		NOT NULL,
TELEFONE		CHAR(8)			NOT NULL,
CARRO			CHAR(7)			NOT NULL

PRIMARY KEY (CARRO)
FOREIGN KEY (CARRO)
		REFERENCES CARRO (PLACA)
)

INSERT INTO CLIENTE
VALUES
('João Alves','R. Pereira Barreto',1258,'Jd. Oliveiras','21549658','DXO9876'),
('Ana Maria','R. 7 de Setembro',259,'Centro','96588541','LKM7380'),
('Clara Oliveira','Av. Nações Unidas',10254,'Pinheiros','24589658','EGT4631'),
('José Simões','R. XV de Novembro',36,'Água Branca','78952459','BCD7521'),
('Paula Rocha','R. Anhaia',548,'Barra Funda','69582548','AFT9087')

CREATE TABLE PECAS(
CODIGO		INT				NOT NULL,	
NOME		VARCHAR(40)		NOT NULL,
VALOR		INT				NOT NULL
PRIMARY KEY (CODIGO)
)

INSERT INTO PECAS
VALUES
(1,'Vela',70),
(2,'Correia Dentada',125),
(3,'Trambulador',90),
(4,'Filtro de Ar',30)

CREATE TABLE SERVICOS(
CARRO			CHAR(07)	NOT NULL,	
PECA			INT			NOT NULL,
QUANTIDADE		INT			NOT NULL,
VALOR			INT			NOT NULL,
DAT				DATE		NOT NULL
PRIMARY KEY (CARRO,PECA,DAT)
FOREIGN KEY (CARRO)
		REFERENCES CARRO(PLACA),
FOREIGN KEY (PECA)
		REFERENCES PECAS (CODIGO)
)

INSERT INTO SERVICOS
VALUES
('DXO9876',1,4,280,'2020-08-01'),
('DXO9876',4,1,30,'2020-08-01'),
('EGT4631',3,1,90,'2020-08-02'),
('DXO9876',2,1,125,'2020-08-07')


-- OP SUB QUERY 1
SELECT SUBSTRING(C.TELEFONE,1,4)+' - '+SUBSTRING(C.TELEFONE,5,8) FROM CLIENTE C
WHERE C.CARRO IN
(
SELECT C.PLACA FROM CARRO C
WHERE C.MODELO = 'Ka' AND C.COR = 'Azul'
)
-- OP SUB QUERY 2
SELECT C.LOGRADOURO+' '+CAST(C.NUM AS VARCHAR(10))+' '+C.BAIRRO FROM CLIENTE C
WHERE C.CARRO IN (
SELECT S.CARRO FROM SERVICOS S
WHERE S.DAT = '2009-08-02'
)
--CONSULTA
--OP1
SELECT C.PLACA FROM CARRO C
WHERE C.ANO < 2001
--OP2
SELECT C.MARCA+' '+C.MODELO+' '+C.COR  FROM CARRO C
WHERE C.ANO > 2005
--OP3
SELECT P.CODIGO,P.NOME FROM PECAS P
WHERE P.VALOR < 80
--------------------------------------------------------------------------------------------------------------
--EX.03
CREATE DATABASE HOSPITAL
USE HOSPITAL

CREATE TABLE PACIENTES(
CPF			CHAR(11)		NOT NULL,
NOME		VARCHAR(40)		NOT NULL,
RUA			VARCHAR(40)		NOT NULL,
NUM			INT				NOT NULL,
BAIRRO		VARCHAR(40)		NOT NULL,
TELEFONE	CHAR(08)		NULL,
DATAN		DATE			NOT NULL
PRIMARY KEY (CPF)
)

INSERT INTO PACIENTES
VALUES 
('35454562890','José Rubens','Campos Salles',2750,'Centro','21450998','1954-10-18'),
('29865439810','Ana Claudia','Sete de Setembro',178,'Centro','97382764','1960-05-29'),
('82176534800','Marcos Aurélio','Timóteo Penteado',236,'Vila Galvão','68172651','1980-09-24'),
('12386758770','Maria Rita','Castello Branco',7765,'Vila Rosália',NULL,'1975-03-30'),
('92173458910','Joana de Souza','XV de Novembro',298,'Centro','21276578','1944-04-24')

CREATE TABLE MEDICO(
CODIGO			INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
ESPECIALIDADE	VARCHAR(20)		NOT NULL
PRIMARY KEY (CODIGO)
)

INSERT INTO MEDICO
VALUES
(1,'Wilson Cesar','Pediatra'),
(2,'Marcia Matos','Geriatra'),
(3,'Carolina Oliveira','Ortopedista'),
(4,'Vinicius Araujo','Clínico Geral')

CREATE TABLE PRONTUARIO(
DAT				DATE			NOT NULL,			
CPF_PACIENTE	CHAR(11)		NOT NULL,
COD_MED		INT					NOT NULL,
DIAGNOSTICO		VARCHAR(30)		NOT NULL,
MEDICAMENTO		VARCHAR(30)		NOT NULL
PRIMARY KEY (DAT,CPF_PACIENTE,COD_MED)
)
INSERT INTO PRONTUARIO
VALUES
('2020-09-10','35454562890',2,'Reumatismo','Celebra'),
('2020-09-10','92173458910',2,'Renite Alérgica','Allegra'),
('2020-09-12','29865439810',1,'Inflamação de garganta','Nimesulida'),
('2020-09-13','35454562890',2,'H1N1','Tamiflu'),
('2020-09-15','82176534800',4,'Gripe','Resprin'),
('2020-09-15','12386758770',3,'Braço Quebrado','Dorflex + Gesso')

--CONSULTA
--OP1
SELECT P.NOME,P.RUA+' '+CONVERT(VARCHAR(10),P.NUM)+' '+P.BAIRRO FROM PACIENTES P
WHERE DATEDIFF(YEAR,P.DATAN,GETDATE())  > 50
--OP2
SELECT MED.ESPECIALIDADE FROM MEDICO MED
WHERE MED.NOME = 'Carolina Oliveira'
--OP3
SELECT P.MEDICAMENTO FROM PRONTUARIO P
WHERE P.DIAGNOSTICO = 'Reumatismo'

--SUBQUERY
--OP1
SELECT P.DIAGNOSTICO,P.MEDICAMENTO FROM PRONTUARIO P
WHERE P.CPF_PACIENTE IN (
SELECT P.CPF FROM PACIENTES P
WHERE P.NOME = 'José Rubens'

)
--OP2
SELECT MED.NOME,
CASE WHEN(LEN(MED.ESPECIALIDADE)>3)
THEN
	SUBSTRING(MED.ESPECIALIDADE,1,3)+'.'
ELSE
	MED.ESPECIALIDADE
END  
FROM MEDICO MED  
WHERE MED.CODIGO IN
(
SELECT P.COD_MED FROM PRONTUARIO P 
INNER JOIN PACIENTES PA ON P.CPF_PACIENTE = PA.CPF
WHERE PA.NOME = 'José Rubens'
)
--OP3
SELECT SUBSTRING(P.CPF,1,3)+'.'+SUBSTRING(P.CPF,4,3)+'.'+SUBSTRING(P.CPF,7,3)+
'-'+SUBSTRING(P.CPF,10,11) AS CPF
,P.NOME,P.RUA+' '+CAST(P.NUM AS VARCHAR(10))+' - '+P.BAIRRO AS ENDERO,
CASE WHEN(P.TELEFONE IS NULL)
THEN
	'-'
ELSE
	P.TELEFONE
END
AS TELEFONE
FROM PACIENTES P
WHERE P.CPF IN(
SELECT P.CPF_PACIENTE FROM PRONTUARIO P INNER JOIN
MEDICO MED ON P.COD_MED = MED.CODIGO
WHERE MED.NOME LIKE 'Vinicius Araujo%'
)
--OP4
SELECT DATEDIFF(DAY,P.DAT,GETDATE()) FROM PACIENTES PA INNER JOIN 
PRONTUARIO P ON PA.CPF = P.CPF_PACIENTE
WHERE PA.NOME = 'Maria Rita'
--OP5
UPDATE PACIENTES 
SET TELEFONE = '98345621'
WHERE NOME = 'Maria Rita'

SELECT * FROM PACIENTES

UPDATE PACIENTES
SET RUA = 'Voluntários da Pátria',NUM = 1980,BAIRRO = ' Jd. Aeroporto'
WHERE NOME = 'Joana de Souza'
--------------------------------------------------------------------------------------------------------------
--EX.04
USE MASTER
CREATE DATABASE CLIENTE_FORNECEDOR_VENDA
USE CLIENTE_FORNECEDOR_VENDA

CREATE TABLE CLIENTE(
CPF			CHAR(11)		NOT NULL,
NOME		VARCHAR(40)		NOT NULL,
TELEFONE	CHAR(08)		NOT NULL
PRIMARY KEY (CPF)
)
INSERT INTO CLIENTE
VALUES
('34578909290','Julio Cesar','82736541'),
('25186533710','Maria Antonia','87652314'),
('87627315416','Luiz Carlos','61289012'),
('79182639800','Paulo Cesar','90765273')

CREATE TABLE PRODUTO(
CODIGO			INT				NOT NULL,
DESCRICAO		VARCHAR(50)		NOT NULL,
FORNECEDOR		INT				NOT NULL,
PRECO			NUMERIC(6,2)	NOT NULL
PRIMARY KEY (CODIGO)
FOREIGN KEY (FORNECEDOR)
			REFERENCES FORNECEDOR (ID)
)
DROP TABLE PRODUTO
INSERT INTO PRODUTO
VALUES
(1,'Monitor 19 pol.',1,449.99),
(2,'Netbook 1GB Ram 4 Gb HD',2,699.99),
(3,'Gravador de DVD - Sata',1,99.99),
(4,'Leitor de CD',1,49.99),
(5,'Processador - Phenom X3 - 2.1GHz',3,349.99),
(6,'Mouse',4,19.99),
(7,'Teclado',4,25.99),
(8,'Placa de Video - Nvidia 9800 GTX - 256MB/256 bits',5,599.99)

CREATE TABLE FORNECEDOR(
ID				INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
LOGRADOURO		VARCHAR(40)		NOT NULL,
NUM				INT				NOT NULL,
COMPLEMENTO		VARCHAR(40)		NOT NULL,
CIDADE			VARCHAR(20)		NOT NULL
PRIMARY KEY (ID)
)

INSERT INTO FORNECEDOR
VALUES
(1,'LG','Rod. Bandeirantes',70000,'Km 70','Itapeva'),
(2,'Asus','Av. Nações Unidas',10206,'Sala 225','São Paulo'),
(3,'AMD','Av. Nações Unidas',10206,'Sala 1095','São Paulo'),
(4,'Leadership','Av. Nações Unidas',10206,'Sala 87','São Paulo'),
(5,'Inno','Av. Nações Unidas',10206,'Sala 34','São Paulo')

CREATE TABLE VENDA(
CODIGO			INT					NOT NULL,
PRODUTO			INT					NOT NULL,
CLIENTE			CHAR(11)			NOT NULL,
QUANTIDADE		INT					NOT NULL,
VAL_TOT			NUMERIC(6,2)		NOT NULL,
DAT				DATE				NOT NULL
PRIMARY KEY (CODIGO,PRODUTO,CLIENTE)
FOREIGN KEY (PRODUTO)
			REFERENCES PRODUTO (CODIGO),
FOREIGN KEY (CLIENTE)
			REFERENCES CLIENTE (CPF)
)

INSERT INTO VENDA
VALUES
(1,1,'25186533710',1,449.99,'2009-09-03'),
(1,4,'25186533710',1, 49.99,'2009-09-03'),
(1,5,'25186533710',1,349.99,'2009-09-03'),
(2,6,'79182639800',4,79.96,'2009-09-06'),
(3,8,'87627315416',1,599.99,'2009-09-06'),
(3,3,'87627315416',1,99.99,'2009-09-06'),
(3,7,'87627315416',1,25.99,'2009-09-06'),
(4,2,'34578909290',2,1399.98,'2009-09-08')

SELECT CONVERT(VARCHAR(10),V.DAT,103) FROM VENDA V
WHERE V.CODIGO = 4

ALTER TABLE FORNECEDOR
ADD TELEFONE		VARCHAR(9)			NULL

EXEC SP_HELP FORNECEDOR 

UPDATE FORNECEDOR
SET TELEFONE = '7216-5371'
WHERE ID = 1
UPDATE FORNECEDOR
SET TELEFONE = '8715-3738'
WHERE ID = 2
UPDATE FORNECEDOR
SET TELEFONE = '3654-6289'
WHERE ID = 4

SELECT F.NOME,F.LOGRADOURO+' '+CAST(F.NUM AS VARCHAR(04))+' '+F.COMPLEMENTO+' '+F.CIDADE, F.TELEFONE
FROM FORNECEDOR F 

SELECT V.PRODUTO, V.QUANTIDADE, V.VAL_TOT  FROM VENDA V
INNER JOIN CLIENTE C ON C.CPF = V.CLIENTE
WHERE C.NOME = 'Julio Cesar' 

SELECT CONVERT(VARCHAR(08),V.DAT,103),V.VAL_TOT FROM VENDA V
INNER JOIN CLIENTE C ON C.CPF = V.CLIENTE
WHERE C.NOME = 'Paulo Cesar' 

SELECT P.DESCRICAO,P.PRECO FROM PRODUTO P
ORDER BY P.DESCRICAO,P.PRECO DESC
--------------------------------------------------------------------------------------------------------------
--EX.05
USE MASTER
CREATE DATABASE CLIENTE_PRODUTO
USE CLIENTE_PRODUTO

CREATE TABLE PRODUTO(
CODIGO					INT					NOT NULL,
NOME					VARCHAR(40)			NOT NULL,
VALOR_UNITARIO			NUMERIC(5,2)		NOT NULL,
QUANTIDADE_ESTOQUE		INT					NOT NULL,
DESCRICAO				VARCHAR(49)			NOT NULL,
CODIGO_FORNECEDOR		INT					NOT NULL
PRIMARY KEY (CODIGO)
FOREIGN KEY (CODIGO_FORNECEDOR)
			REFERENCES FORNECEDORES (CODIGO)
)
INSERT INTO PRODUTO
VALUES
(1,'Banco Imobiliário',65.00,15,'Versão Super Luxo',1001),
(2,'Puzzle 5000 peças',50.00,5,'Mapas Mundo',1005),
(3,'Faqueiro',350.00,0,'120 peças',1004),
(4,'Jogo para churrasco',75.00,3,'7 peças',1004),
(5,'Tablet',750.00,29,'Tablet',1003),
(6,'Detetive',49.00,0,'Nova Versão do Jogo',1001),
(7,'Chocolate com Paçoquinha',6.00,0,'Barra',1002),
(8,'Galak',5.00,65,'Barra',1002)

CREATE TABLE FORNECEDORES(
CODIGO			INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
ATIVIDADE		VARCHAR(40)		NOT NULL,
TELEFONE		CHAR(08)		NOT NULL
PRIMARY KEY (CODIGO)
)
INSERT INTO FORNECEDORES
VALUES
(1001,'Estrela','Brinquedo','41525898'),
(1002,'Lacta','Chocolate','42698596'),
(1003,'Asus','Informática','52014596'),
(1004,'Tramontina','Utensílios Domésticos','50563985'),
(1005,'Grow','Brinquedos','47896325'),
(1006,'Mattel','Bonecos','59865898')

CREATE TABLE CLIENTE(
CODIGO			INT				NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
LOGRADOURO		VARCHAR(40)		NOT NULL,
NUMERO			INT				NOT NULL,
TELEFONE		CHAR(08)		NOT NULL,
DATAN			DATE			NOT NULL
PRIMARY KEY (CODIGO)
)

INSERT INTO CLIENTE
VALUES
(33601,'Maria Clara','R. 1° de Abril',870,'96325874','2000-08-15'),
(33602,'Alberto Souza','R. XV de Novembro',987,'95873625','1985-02-02'),
(33603,'Sonia Silva','R. Voluntários da Pátria',1151,'75418596','1957-08-23'),
(33604,'José Sobrinho','Av. Paulista',250,'85236547','1986-12-09'),
(33605,'Carlos Camargo','Av. Tiquatira',9652,'75896325','1971-03-25')

CREATE TABLE PEDIDO(
CODIGO				INT		NOT NULL,
CODIGO_CLIENTE		INT		NOT NULL,
CODIGO_PRODUTO		INT		NOT NULL,
QUANTIDADE			INT		NOT NULL,
PREVISAO_ENTREGA	DATE	NOT NULL

PRIMARY KEY (CODIGO,CODIGO_CLIENTE,CODIGO_PRODUTO)
FOREIGN KEY (CODIGO_CLIENTE)
			REFERENCES CLIENTE (CODIGO),
FOREIGN KEY (CODIGO_PRODUTO)
			REFERENCES PRODUTO (CODIGO)
)

INSERT INTO PEDIDO
VALUES
(99001,33601,1,1,'2012-06-07'),
(99001,33601,2,1,'2012-06-07'),
(99001,33601,8,3,'2012-06-07'),
(99002,33602,2,1,'2012-06-09'),
(99002,33602,4,3,'2012-06-09'),
(99003,33605,5,1,'2012-06-15')


--OP1
SELECT P.QUANTIDADE,(P.QUANTIDADE*PR.VALOR_UNITARIO),
(P.QUANTIDADE*PR.VALOR_UNITARIO) -
((P.QUANTIDADE*PR.VALOR_UNITARIO)*0.25)
FROM PEDIDO P
INNER JOIN CLIENTE C ON P.CODIGO_CLIENTE = C.CODIGO
INNER JOIN PRODUTO PR ON PR.CODIGO = P.CODIGO_PRODUTO
WHERE C.NOME = 'Maria Clara'

--OP2
SELECT * FROM PRODUTO PR 
WHERE PR.QUANTIDADE_ESTOQUE  = 0
--OP3
UPDATE PRODUTO 
SET VALOR_UNITARIO =  VALOR_UNITARIO-( VALOR_UNITARIO*0.10)
WHERE NOME = 'Chocolate com Paçoquinha'
--OP4
UPDATE PRODUTO
SET DESCRICAO = '10 peças'
WHERE NOME = 'Faqueiro'
--OP5
SELECT COUNT(C.CODIGO) FROM CLIENTE C
WHERE DATEDIFF(YEAR,C.DATAN,GETDATE()) > 40
--OP6
SELECT F.NOME,F.TELEFONE FROM FORNECEDORES F
WHERE F.ATIVIDADE LIKE 'Brinquedos' OR  F.ATIVIDADE LIKE 'Chocolate'
--OP7
SELECT P.DESCRICAO,
P.VALOR_UNITARIO - P.VALOR_UNITARIO*0.25 AS COM_DESCONTO
FROM PRODUTO P 
WHERE P.VALOR_UNITARIO < 50
--OP8
SELECT P.DESCRICAO,
P.VALOR_UNITARIO + P.VALOR_UNITARIO*0.10 AS COM_DESCONTO
FROM PRODUTO P 
WHERE P.VALOR_UNITARIO > 100
--OP9
SELECT 
PR.NOME,
(PR.VALOR_UNITARIO * P.QUANTIDADE)*0.15 AS DESCONTO
FROM PRODUTO PR
INNER JOIN PEDIDO P ON PR.CODIGO = P.CODIGO_PRODUTO
WHERE P.CODIGO = '99001'
--EP10
SELECT P.CODIGO,C.NOME,DATEDIFF(YEAR,C.DATAN,GETDATE()) FROM PEDIDO P
INNER JOIN CLIENTE C ON C.CODIGO = P.CODIGO_CLIENTE
--------------------------------------------------------------------------------------------------------------
